<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="python基础知识(三十二)"><meta name="keywords" content="python"><meta name="author" content="逆の神様"><meta name="copyright" content="逆の神様"><meta name="theme-color" content="#0078E7"><title>python基础知识(三十二) | 逆の神様の小さな駅</title><link rel="shortcut icon" href="/fcg22450.github.io/favicon.png"><link rel="mask-icon" href="/fcg22450.github.io/favicon.png" color="#0078E7"><link rel="preload" href="/fcg22450.github.io/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/fcg22450.github.io/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/fcg22450.github.io/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/fcg22450.github.io/css/hexo-theme-yun.css"><script id="yun-config">
    let Yun = window.Yun || {};
    let CONFIG = {"root":"/fcg22450.github.io/","title":"逆の神様の小さな駅","version":"0.6.3","anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"/fcg22450.github.io/data/sentences.json"},"fireworks":{"colors":["254, 185, 6","223, 47, 47","102, 167, 221","62, 131, 225","33, 78, 194","3, 28, 95","0, 8, 55"]}};
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@700&amp;family=Source+Code+Pro&amp;display=swap" media="none" onload="this.media='all'"><script src="//at.alicdn.com/t/font_1140697_rtqh36oinzl.js" async></script><meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/fcg22450.github.io/css/prism.css" type="text/css"></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script defer src="/fcg22450.github.io/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle sidebar-toggle-fixed hty-icon-button"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><aside class="sidebar"><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc sidebar-nav-active hty-icon-button" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/fcg22450.github.io/about" title="逆の神様"><img width="96" loading="lazy" src="/fcg22450.github.io/author.jpg" alt="逆の神様"></a><div class="site-author-name"><a href="/fcg22450.github.io/about/">逆の神様</a></div><a class="site-name" href="/fcg22450.github.io/about/site.html">逆の神様の小さな駅</a><sub class="site-subtitle">逆の神様の小さな駅</sub><div class="site-desciption">潦倒不通世务，愚顽怕读文章。</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/fcg22450.github.io/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item site-state-posts"><a href="/fcg22450.github.io/archives" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">159</span></a></div><div class="site-state-item site-state-categories"><a href="/fcg22450.github.io/categories" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">13</span></a></div><div class="site-state-item site-state-tags"><a href="/fcg22450.github.io/tags" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">17</span></a></div><a class="site-state-item hty-icon-button" href="http://fcg22450.gitee.io/new_blog/" target="_blank" rel="noopener" title="随笔"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=1263893578&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/fcg22450" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:fcg0322@gmail.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/6553522553" title="微博" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="/fcg22450.git/images/wechat.jpg" title="微信" target="_blank" style="color:#1AAD19"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-2-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/317139394" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.now.sh/" title="Travelling" target="_blank" style="color:black"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-send-plane-2-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/fcg22450.github.io/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a><a class="links-item hty-icon-button" href="/fcg22450.github.io/girls/" title="老婆们 ( 嚣张的我~o(*￣▽￣*)ブ~ )" style="color:hotpink"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-women-line"></use></svg></a></div></div><script defer src="/fcg22450.github.io/js/sidebar.js"></script><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#套接字socket"><span class="toc-number">1.</span> <span class="toc-text">套接字socket</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#socket模块"><span class="toc-number">1.1.</span> <span class="toc-text">socket模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建套接字"><span class="toc-number">1.1.1.</span> <span class="toc-text">创建套接字</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#参数"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">参数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#基于TCP协议的socket"><span class="toc-number">1.1.2.</span> <span class="toc-text">基于TCP协议的socket</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#server端"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">server端</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#client端"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">client端</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#常见报错"><span class="toc-number">1.1.3.</span> <span class="toc-text">常见报错</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#基于UDP协议的socket"><span class="toc-number">1.1.4.</span> <span class="toc-text">基于UDP协议的socket</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#server端-1"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">server端</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#client端-1"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">client端</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#更多方法介绍"><span class="toc-number">1.1.5.</span> <span class="toc-text">更多方法介绍</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#socketserver模块"><span class="toc-number">1.2.</span> <span class="toc-text">socketserver模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#server端-2"><span class="toc-number">1.2.1.</span> <span class="toc-text">server端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#client端-2"><span class="toc-number">1.2.2.</span> <span class="toc-text">client端</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#黏包"><span class="toc-number">1.3.</span> <span class="toc-text">黏包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#黏包成因"><span class="toc-number">1.3.1.</span> <span class="toc-text">黏包成因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#解决方案"><span class="toc-number">1.3.2.</span> <span class="toc-text">解决方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#struct模块"><span class="toc-number">1.4.</span> <span class="toc-text">struct模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#使用struct自制报头"><span class="toc-number">1.4.0.1.</span> <span class="toc-text">使用struct自制报头</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://github.com/fcg22450/fcg22450.github.io/fcg22450.github.io/2019/10/05/python_foundation/032.html"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="逆の神様"><meta itemprop="description" content="python基础知识(三十二)"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="逆の神様の小さな駅"></span><header class="post-header"><h1 class="post-title" itemprop="name headline" style="color: undefined">python基础知识(三十二)</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <span class="post-meta-icon-text">发表于</span> <time title="创建时间：2019-10-05 00:00:00" itemprop="dateCreated datePublished" datetime="2019-10-05T00:00:00+08:00">2019-10-05</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <span class="post-meta-icon-text">更新于</span> <time title="修改时间：2020-06-01 15:23:14" itemprop="dateModified" datetime="2020-06-01T15:23:14+08:00">2020-06-01</time></div><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/fcg22450.github.io/categories/online-course/" itemprop="url" rel="index"><span itemprop="text">online_course</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/fcg22450.github.io/tags/python/"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">python</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content post-markdown"><h2 id="套接字socket"><a href="#套接字socket" class="headerlink" title="套接字socket"></a>套接字socket</h2><blockquote>
<p>套接字起源于 20 世纪 70 年代加利福尼亚大学伯克利分校版本的 Unix,即人们所说的 BSD Unix。 因此,有时人们也把套接字称为“伯克利套接字”或“BSD 套接字”。一开始,套接字被设计用在同 一台主机上多个应用程序之间的通讯。这也被称进程间通讯或IPC。</p>
</blockquote>
<h3 id="socket模块"><a href="#socket模块" class="headerlink" title="socket模块"></a>socket模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/socket.html" target="_blank" rel="noopener"><code>socket</code></a>模块提供了访问 BSD套接字的接口</p>
<h4 id="创建套接字"><a href="#创建套接字" class="headerlink" title="创建套接字"></a>创建套接字</h4><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socket
s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h5 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h5><ul>
<li>AF_INET 面向网络的套接字（默认种族）</li>
<li>AF_UNIX 基于文件的套接字</li>
<li>TCP套接字的名SOCK_STREAM（默认类型）</li>
<li>UDP套接字的名SOCK_DGRAM</li>
</ul>
<table>
<thead>
<tr>
<th>常用方法</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><code>s.bind()</code></td>
<td>绑定(主机,端口号)到套接字</td>
</tr>
<tr>
<td><code>s.listen()</code></td>
<td>开始TCP监听</td>
</tr>
<tr>
<td><code>s.accept()</code></td>
<td>被动接受TCP客户的连接,(阻塞式)等待连接的到来</td>
</tr>
<tr>
<td><code>s.connect()</code></td>
<td>主动初始化TCP服务器连接</td>
</tr>
<tr>
<td><code>s.connect_ex()</code></td>
<td><code>connect()</code>函数的扩展版本,出错时返回出错码,而不是抛出异常</td>
</tr>
<tr>
<td><code>s.recv()</code></td>
<td>#接收TCP数据</td>
</tr>
<tr>
<td><code>s.send()</code></td>
<td>#发送TCP数据</td>
</tr>
<tr>
<td><code>s.sendall()</code></td>
<td>#发送TCP数据</td>
</tr>
<tr>
<td><code>s.recvfrom()</code></td>
<td>#接收UDP数据</td>
</tr>
<tr>
<td><code>s.sendto()</code></td>
<td>#发送UDP数据</td>
</tr>
<tr>
<td><code>s.getpeername()</code></td>
<td>#连接到当前套接字的远端的地址</td>
</tr>
<tr>
<td><code>s.getsockname()</code></td>
<td>#当前套接字的地址</td>
</tr>
<tr>
<td><code>s.getsockopt()</code></td>
<td>#返回指定套接字的参数</td>
</tr>
<tr>
<td><code>s.setsockopt()</code></td>
<td>#设置指定套接字的参数</td>
</tr>
<tr>
<td><code>s.close()</code></td>
<td>#关闭套接字，也支持with上下文管理<code>socket.socket()</code></td>
</tr>
</tbody></table>
<h4 id="基于TCP协议的socket"><a href="#基于TCP协议的socket" class="headerlink" title="基于TCP协议的socket"></a>基于TCP协议的socket</h4><h5 id="server端"><a href="#server端" class="headerlink" title="server端"></a>server端</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socket
sk <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#即socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span>
sk<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">8898</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#把地址绑定到套接字</span>
sk<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token comment" spellcheck="true">#监听链接</span>
conn<span class="token punctuation">,</span>addr <span class="token operator">=</span> sk<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#接受客户端链接 会和input一样一直等待连接</span>
ret <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#接收客户端信息 会和input一样一直等待着信</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>       <span class="token comment" spellcheck="true">#打印客户端信息</span>
conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span>b<span class="token string">'hi'</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#向客户端发送信息</span>
conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment" spellcheck="true">#关闭客户端套接字</span>
sk<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#关闭服务器套接字(可选)</span></code></pre>
<h5 id="client端"><a href="#client端" class="headerlink" title="client端"></a>client端</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socket
sk <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 创建客户套接字</span>
sk<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">8898</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># 尝试连接服务器</span>
sk<span class="token punctuation">.</span>send<span class="token punctuation">(</span>b<span class="token string">'hello!'</span><span class="token punctuation">)</span>
ret <span class="token operator">=</span> sk<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>         <span class="token comment" spellcheck="true"># 对话(发送/接收)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
sk<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># 关闭客户套接字</span></code></pre>
<h4 id="常见报错"><a href="#常见报错" class="headerlink" title="常见报错"></a>常见报错</h4><p>Traceback(most recent call last):</p>
<p>OSError: [Error 48] Address already in use</p>
<p>解决方法： 加入一条socket配置，重用ip和端口</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socket
<span class="token keyword">from</span> socket <span class="token keyword">import</span> SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR
sk <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span>
sk<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>SOL_SOCKET<span class="token punctuation">,</span>SO_REUSEADDR<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#就是它，在bind前加</span>
sk<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">8898</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sk<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>Traceback(most recent call last):</p>
<p>ConnectionRefusedError: [WinError 10061] 由于目标计算机积极拒绝，无法连接。</p>
<p>解决方法： 修改防火墙设置或者换一个端口号</p>
<h4 id="基于UDP协议的socket"><a href="#基于UDP协议的socket" class="headerlink" title="基于UDP协议的socket"></a>基于UDP协议的socket</h4><p>udp无需监听和建立连接。</p>
<p>udp收发消息会分别接收和发送对方的地址（addr）。</p>
<h5 id="server端-1"><a href="#server端-1" class="headerlink" title="server端"></a>server端</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socket
udp_sk <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>type<span class="token operator">=</span>socket<span class="token punctuation">.</span>SOCK_DGRAM<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">#创建一个服务器的套接字</span>
udp_sk<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#绑定服务器套接字</span>
msg<span class="token punctuation">,</span>addr <span class="token operator">=</span> udp_sk<span class="token punctuation">.</span>recvfrom<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
udp_sk<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span>b<span class="token string">'hi'</span><span class="token punctuation">,</span>addr<span class="token punctuation">)</span>                 <span class="token comment" spellcheck="true"># 对话(接收与发送)</span>
udp_sk<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                         <span class="token comment" spellcheck="true"># 关闭服务器套接字</span></code></pre>
<h5 id="client端-1"><a href="#client端-1" class="headerlink" title="client端"></a>client端</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socket
ip_port<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span><span class="token number">9000</span><span class="token punctuation">)</span>
udp_sk<span class="token operator">=</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>type<span class="token operator">=</span>socket<span class="token punctuation">.</span>SOCK_DGRAM<span class="token punctuation">)</span>
udp_sk<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span>b<span class="token string">'hello'</span><span class="token punctuation">,</span>ip_port<span class="token punctuation">)</span>
back_msg<span class="token punctuation">,</span>addr<span class="token operator">=</span>udp_sk<span class="token punctuation">.</span>recvfrom<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>back_msg<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>addr<span class="token punctuation">)</span></code></pre>
<h4 id="更多方法介绍"><a href="#更多方法介绍" class="headerlink" title="更多方法介绍"></a>更多方法介绍</h4><ul>
<li><p>面向锁</p>
<table>
<thead>
<tr>
<th><code>s.setblocking()</code></th>
<th>设置套接字的阻塞与非阻塞模式</th>
</tr>
</thead>
<tbody><tr>
<td><code>s.settimeout()</code></td>
<td>设置阻塞套接字操作的超时时间</td>
</tr>
<tr>
<td><code>s.gettimeout()</code></td>
<td>得到阻塞套接字操作的超时时间</td>
</tr>
</tbody></table>
</li>
<li><p>面向文件</p>
<table>
<thead>
<tr>
<th><code>s.fileno()</code></th>
<th>套接字的文件描述符</th>
</tr>
</thead>
<tbody><tr>
<td><code>s.makefile()</code></td>
<td>创建一个与该套接字相关的文件</td>
</tr>
</tbody></table>
</li>
</ul>
<p>官方文档对socket模块下的<code>socket.send()</code>和<code>socket.sendall()</code>解释如下：</p>
<pre class=" language-python"><code class="language-python">socket<span class="token punctuation">.</span>send<span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">,</span> flags<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">'''Send data to the socket. The socket must be connected to a remote socket.
The optional flags argument has the same meaning as for recv() above. 
Returns the number of bytes sent. 
Applications are responsible for checking that all data has been sent; 
if only some of the data was transmitted, 
the application needs to attempt delivery of the remaining data.
send()的返回值是发送的字节数量，这个数量值可能小于要发送的string的字节数，
也就是说可能无法发送string中所有的数据。如果有错误则会抛出异常。'''</span>
    <span class="token keyword">pass</span>

socket<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">,</span> flags<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">'''Send data to the socket. 
The socket must be connected to a remote socket. 
The optional flags argument has the same meaning as for recv() above. 
Unlike send(), this method continues to send data 
from string until either all data has been sent or an error occurs. 
None is returned on success. 
On error, an exception is raised, 
and there is no way to determine how much data, 
if any, was successfully sent.
尝试发送string的所有数据，成功则返回None，失败则抛出异常。
故，下面两段代码是等价的：'''</span>
<span class="token comment" spellcheck="true">#sock.sendall('Hello world\n')</span>
<span class="token comment" spellcheck="true">#buffer = 'Hello world\n'</span>
<span class="token comment" spellcheck="true">#while buffer:</span>
<span class="token comment" spellcheck="true">#    bytes = sock.send(buffer)</span>
<span class="token comment" spellcheck="true">#    buffer = buffer[bytes:]</span>
    <span class="token keyword">pass</span></code></pre>
<h3 id="socketserver模块"><a href="#socketserver模块" class="headerlink" title="socketserver模块"></a>socketserver模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/socketserver.html" target="_blank" rel="noopener"><code>socketserver</code></a>模块使一个server端可以同时和多个client端连接（多线程)</p>
<p>与只使用socket时<code>conn,addr = sk.accept()</code>相同的是<br>继承<code>socketserver.BaseRequestHandler</code>之后<br><code>self.request</code> 就相当于conn<br><code>self.client_address</code> 就相当于addr</p>
<h4 id="server端-2"><a href="#server端-2" class="headerlink" title="server端"></a>server端</h4><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socketserver

<span class="token keyword">class</span> <span class="token class-name">Myserver</span><span class="token punctuation">(</span>socketserver<span class="token punctuation">.</span>BaseRequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>data <span class="token operator">=</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{} wrote:"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>self<span class="token punctuation">.</span>client_address<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    HOST<span class="token punctuation">,</span> PORT <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">9999</span>
    <span class="token comment" spellcheck="true"># 设置allow_reuse_address允许服务器重用地址</span>
    socketserver<span class="token punctuation">.</span>TCPServer<span class="token punctuation">.</span>allow_reuse_address <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token comment" spellcheck="true"># 创建一个server, 将服务地址绑定到127.0.0.1:9999</span>
    server <span class="token operator">=</span> socketserver<span class="token punctuation">.</span>TCPServer<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">,</span>Myserver<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 让server永远运行下去，除非强制停止程序</span>
    server<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h4 id="client端-2"><a href="#client端-2" class="headerlink" title="client端"></a>client端</h4><p>就是最前面的基于TCP的套接字的C端，这里使用with上下文管理的写法</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socket

HOST<span class="token punctuation">,</span> PORT <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">9999</span>
data <span class="token operator">=</span> <span class="token string">"hello"</span>

<span class="token keyword">with</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span> <span class="token keyword">as</span> sock<span class="token punctuation">:</span>
    sock<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>HOST<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span><span class="token punctuation">)</span>
    sock<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>bytes<span class="token punctuation">(</span>data <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    received <span class="token operator">=</span> str<span class="token punctuation">(</span>sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Sent:     {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Received: {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>received<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h3 id="黏包"><a href="#黏包" class="headerlink" title="黏包"></a>黏包</h3><p>现象 : 同时执行多条命令之后，得到的结果很可能只有一部分，在执行其他命令的时候又接收到之前执行的另外一部分结果，这种显现就是黏包。</p>
<h4 id="黏包成因"><a href="#黏包成因" class="headerlink" title="黏包成因"></a>黏包成因</h4><ul>
<li>TCP协议的拆包机制<br>当发送端缓冲区的长度大于网卡的MTU时TCP会将这次发送的数据拆成几个数据包发送出去。</li>
<li>面向流的通信特点和Nagle算法<br>Nagle算法优化后将多次间隔较小且数据量小的数据，合并成一个大的数据块，然后进行封包。</li>
</ul>
<p><img src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAAAAD/4QMqaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjUtYzAxNCA3OS4xNTE0ODEsIDIwMTMvMDMvMTMtMTI6MDk6MTUgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QUUyMEZGNjM5N0MyMTFFOTlCODhDNjc0NTEzNTdGRjEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QUUyMEZGNjQ5N0MyMTFFOTlCODhDNjc0NTEzNTdGRjEiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBRTIwRkY2MTk3QzIxMUU5OUI4OEM2NzQ1MTM1N0ZGMSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBRTIwRkY2Mjk3QzIxMUU5OUI4OEM2NzQ1MTM1N0ZGMSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pv/uAA5BZG9iZQBkwAAAAAH/2wCEABsaGikdKUEmJkFCLy8vQkc/Pj4/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" alt="img" loading="lazy"></p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>思路：制作报头，提前让接收端知晓自己将要发送的字节流总大小</p>
<p>让发送端在发送数据前，发送<strong>固定长度</strong>的报头，然后接收端循环接收完所有数据。</p>
<h3 id="struct模块"><a href="#struct模块" class="headerlink" title="struct模块"></a>struct模块</h3><p><a href="https://docs.python.org/zh-cn/3/library/struct.html" target="_blank" rel="noopener"><code>struct</code></a>可以把以下类型转成固定长度的bytes</p>
<table>
<thead>
<tr>
<th>Format</th>
<th>C Type</th>
<th>Python type</th>
<th>Standard size</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td>x</td>
<td>pad byte</td>
<td>no value</td>
<td></td>
<td></td>
</tr>
<tr>
<td>c</td>
<td>char</td>
<td>string of length 1</td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>b</td>
<td>signed char</td>
<td>integer</td>
<td>1</td>
<td>(3)</td>
</tr>
<tr>
<td>B</td>
<td>unsigned char</td>
<td>integer</td>
<td>1</td>
<td>(3)</td>
</tr>
<tr>
<td>?</td>
<td>_Bool</td>
<td>bool</td>
<td>1</td>
<td>(1)</td>
</tr>
<tr>
<td>h</td>
<td>short</td>
<td>integer</td>
<td>2</td>
<td>(3)</td>
</tr>
<tr>
<td>H</td>
<td>unsigned short</td>
<td>integer</td>
<td>2</td>
<td>(3)</td>
</tr>
<tr>
<td>i</td>
<td>int</td>
<td>integer</td>
<td>4</td>
<td>(3)</td>
</tr>
<tr>
<td>I</td>
<td>unsigned int</td>
<td>integer</td>
<td>4</td>
<td>(3)</td>
</tr>
<tr>
<td>l</td>
<td>long</td>
<td>integer</td>
<td>4</td>
<td>(3)</td>
</tr>
<tr>
<td>L</td>
<td>unsigned long</td>
<td>integer</td>
<td>4</td>
<td>(3)</td>
</tr>
<tr>
<td>q</td>
<td>long long</td>
<td>integer</td>
<td>8</td>
<td>(2)(3)</td>
</tr>
<tr>
<td>Q</td>
<td>unsigned long long</td>
<td>integer</td>
<td>8</td>
<td>(2)(3)</td>
</tr>
<tr>
<td>f</td>
<td>float</td>
<td>float</td>
<td>4</td>
<td>(4)</td>
</tr>
<tr>
<td>d</td>
<td>double</td>
<td>float</td>
<td>8</td>
<td>(4)</td>
</tr>
<tr>
<td>s</td>
<td>char[]</td>
<td>string</td>
<td></td>
<td></td>
</tr>
<tr>
<td>P</td>
<td>char[]</td>
<td>string</td>
<td></td>
<td></td>
</tr>
<tr>
<td>p</td>
<td>void *</td>
<td>integer</td>
<td></td>
<td>(5)(3)</td>
</tr>
</tbody></table>
<ul>
<li><code>struct.pack()</code></li>
<li><code>struct.unpack()</code></li>
</ul>
<p><code>.pack()</code>和<code>.unpack()</code>的参数一样：</p>
<pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">,</span><span class="token number">1111111111111</span><span class="token punctuation">)</span>

struct<span class="token punctuation">.</span>error<span class="token punctuation">:</span> <span class="token string">'i'</span> format requires <span class="token operator">-</span><span class="token number">2147483648</span> <span class="token operator">&lt;=</span> number <span class="token operator">&lt;=</span> <span class="token number">2147483647</span> <span class="token comment" spellcheck="true">#这个是范围</span></code></pre>
<p><code>.unpack()</code>将返回一个元组。</p>
<h5 id="使用struct自制报头"><a href="#使用struct自制报头" class="headerlink" title="使用struct自制报头"></a>使用struct自制报头</h5><p>以远程终端功能（雾）为例：</p>
<p>服务端（自定制报头）</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token punctuation">,</span> struct<span class="token punctuation">,</span> os<span class="token punctuation">,</span> subprocess
s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
s<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token punctuation">)</span>
conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    cmd <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    cd <span class="token operator">=</span> cmd<span class="token punctuation">.</span>split<span class="token punctuation">(</span>b<span class="token string">'cd '</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> len<span class="token punctuation">(</span>cd<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span>str<span class="token punctuation">(</span>cd<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'cmd: %s'</span> <span class="token operator">%</span> cmd<span class="token punctuation">)</span>
    res <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span>cmd<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                           shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                           stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span>
                           stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span>
    back_msg <span class="token operator">=</span> res<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">or</span> res<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span>struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">,</span> len<span class="token punctuation">(</span>back_msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#先发报头：back_msg的长度</span>
    conn<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>back_msg<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#再发真实的内容</span>
conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>客户端（自定制报头）</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token punctuation">,</span> struct
s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
res <span class="token operator">=</span> s<span class="token punctuation">.</span>connect_ex<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
res <span class="token operator">and</span> <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    msg <span class="token operator">=</span> input<span class="token punctuation">(</span><span class="token string">'>>> '</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> len<span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">continue</span>
    <span class="token keyword">if</span> msg <span class="token operator">==</span> <span class="token string">':q'</span><span class="token punctuation">:</span> <span class="token keyword">break</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data_len <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">#接收报头</span>
    now_len <span class="token operator">=</span> <span class="token number">0</span>
    all_data <span class="token operator">=</span> b<span class="token string">''</span>
    <span class="token keyword">while</span> now_len <span class="token operator">&lt;</span> data_len<span class="token punctuation">:</span>
        now_data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
        all_data <span class="token operator">+=</span> now_data
        now_len <span class="token operator">+=</span> len<span class="token punctuation">(</span>now_data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>all_data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'gbk'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#windows默认gbk编码</span>
s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>自此，黏包问题被完美解决。事实上，应用层的协议（FTP等）本质上就是定制的稍微复杂一点的报头。</p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">我很可爱，请给我钱</div><div id="qr" style="display:none;"><div style="display:inline-block"><a href="/images/alipay.png"><img loading="lazy" src="/fcg22450.github.io/images/alipay.png" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/qqpay.png"><img loading="lazy" src="/fcg22450.github.io/images/qqpay.png" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a href="/images/weixin.png"><img loading="lazy" src="/fcg22450.github.io/images/weixin.png" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>逆の神様</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://github.com/fcg22450/fcg22450.github.io/2019/10/05/python_foundation/032.html" title="python基础知识(三十二)">https://github.com/fcg22450/fcg22450.github.io/2019/10/05/python_foundation/032.html</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/fcg22450.github.io/2019/10/11/python_foundation/033.html" rel="prev" title="python基础知识(三十三)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">python基础知识(三十三)</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/fcg22450.github.io/2019/10/03/python_foundation/031.html" rel="next" title="python基础知识(三十一)"><span class="post-nav-text">python基础知识(三十一)</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"><span>若您无 GitHub 账号，可直接在下方匿名评论。</span><br><span>若您想及时得到回复提醒，建议跳转 GitHub Issues 评论。</span><br><span>若没有本文 Issue，您可以使用 Comment 模版新建。</span><br><a class="hty-button hty-button--raised" id="github-issues" href="https://github.com/fcg22450/fcg22450.github.io/issues?q=is:issue+python基础知识(三十二)">GitHub Issues</a></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2018 – 2020 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> 逆の神様</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v4.2.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v0.6.3</span></div><div class="live_time"><span>本博客已萌萌哒地运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  window.setTimeout(blog_live_time, 1000);
  const start = new Date('2018-09-12T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div><div id="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv" title="总访客量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-user-line"></use></svg></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="总访问量"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg></span><span id="busuanzi_value_site_pv"></span></span></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div><script defer src="/fcg22450.github.io/js/hexo-theme-yun.js"></script><script src="/fcg22450.github.io/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>